<link rel="stylesheet" href="../../css/contentstyle.css">
<div style="width: 95%; 
            color: #fff; 
            font-family:'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
            text-align: justify;
            padding-top: 25px;
            padding-left: 2.5%">

    <h1>Калькулятор</h1>
    <p>Перед тем как перейти к полноценному использованию движка, необходимо закрепить полученные знания на практике, и немного вникнуть в принципы работы с движком. Раздел "Легкий старт" существует как раз для этого. Ну и также увидим, что термин "игровой движок" применяется, на самом деле, лишь для обозначения круга задач которые выполняет среда разработки, однако это не значит что его нельзя использовать не по назначению.</p>
    <p>Попробуем сделать наш первый калькулятор. Создаём новый проект, и в новом проекте выбираем узел «2D Сцена».</p>
    <p>Для того, чтобы у нас не было проблем с масштабированием окна – сразу задаём необходимые настройки в окне настроек проекта. Для этого в меню выбираем «Проект» -> «Настройки проекта», и в открывшемся окне слева открываем пункт «Настройки» в графе «Дисплей». Выставляем комфортную для нас ширину и высоту окна, и убираем галочку с пункта «Изменяемый размер», как показано на рисунке.</p>
    <div class="imagediv"><img src="imgs/projecttunning.png"></div>
    <p>Закрываем окно и видим, как синяя рамка в окне вьюпорта изменила границы – она обозначает размер отрисовываемой области. Все последующие элементы приложения необходимо уместить внутри этой рамки.</p>
    <p>Для калькулятора нам необходимо:
    <ul>
        <li>Цифровое табло</li>
        <li>Кнопки математических операций</li>
        <li>Кнопка равенства</li>
        <li>Кнопка изменения знака числа</li>
        <li>Табло для отображения результата</li>
    </ul></p>
    <p>Для создания кнопок используйте узел «Button». Назовите узлы кнопок в дереве сцены в соответствии с их знаками. При помощи инструмента «Scale» («Изменение масштаба») увеличьте кнопки до комфортной ширины и высоты, и расставьте. При масштабировании элемента масштабируется и текст внутри него.</p>
    <p>Для создания табло воспользуйтесь узлом типа «Label». В свойствах «Label» поменяйте значение свойства «Align» на «Right». Для того чтобы табло было на чёрном фоне под него стоит положить «ColorRect». Можно как сделать его родительским элементом, так и просто по иерархии поставить выше, как на изображении.</p>
    <div class="imagediv"><img src="imgs/calcinterface.png"></div>
    <p>Как можно заметить из рисунка – некоторые узлы в дереве сцены «раздают вай-фай» - это означает что у них есть сигналы, и они подсоединены к скрипту какого-либо узла. По совершении некоторого действия сигнал будет отправлен в присоединённый к нему узел, и будет совершено действие, на которое этот сигнал указывает. Конкретно в случае с картинкой сигнал от кнопки «clear» ведёт к функции «_on_clear_pressed», которая расположена в Node2D. Создайте скрипт для узла Node2D, и присоедините функциональные кнопки к ново созданному скрипту данного узла как это сделано на изображении (кнопки с цифрами пока не трогаем). Каждый раз при присоединении Godot будет автоматически показывать созданные принимающие функции скрипта. Опишем их позже.</p>
    <p>Прежде чем работать с числами – нам необходимо их как-то записывать, и где-то хранить. Создадим две переменные, которые будут хранить текущее значение, и результат вычислений, а также обратимся к нашему экрану вывода числа.</p>
    <pre><code class="code"><hr># Основная переменная отвечающая за текущее число
var numb = 0
# Переменная отвечающая за результат
var res = 0
# Получаем текстовый экран для вывода чисел
onready var label = $ColorRect/Label # просто перетащили сюда Label из дерева сцены<hr></code></pre>
    <i>В Godot 4 вместо onready используется @onready</i>
<p>После этого сделаем так, чтобы можно было к текущему числу добавить цифру в конец числа (как со строкой – дописать число в конец, записывая число слева направо). Для этого опишем функцию «add_number», которая будет умножать число на 10, после чего просто прибавлять к нему цифру.</p>
    <pre><code class="code"><hr>func _add_number(number):
    numb = (numb * 10) + number
    label.text = str(numb)<hr></code></pre>
    <p>Теперь обработаем кнопки цифровой клавиатуры. Ранее мы присоединяли сигнал через свойства узла, но мы также можем это сделать из кода. Для этого нам необходимо обратиться к узлу, и вызвать у него метод «connect», которому мы указываем какое событие желаем обработать, на какой узел перенаправить это событие, какой метод узла вызвать, и можем также передать необходимые аргументы в виде списка. На предыдущем рисунке видно, что кнопки названы от нуля до девяти – обратимся к каждой из них по именам, и соединим с нашим методом добавления числа похожим образом:</p>
    <pre><code class="code"><hr>func _ready():
    # Присоединяем нажатие на кнопки к целевым функциям
    $"0".connect("pressed", self, "add_number", [0])
    $"1".connect("pressed", self, "add_number", [1])
    $"2".connect("pressed", self, "add_number", [2])
    …<hr></code></pre>
    <p>Таким образом мы избегаем необходимости создавать уникальные функции под сигнал каждой из кнопок, и обрабатываем все кнопки цифр одной небольшой функцией. Можете проверить работоспособность кнопок запустив проект, предварительно сохранив сцену перед запуском.</p>
    <p>Давайте теперь разберёмся с операциями. Наша задача сделать так, чтобы на калькуляторе можно было считать последовательности любой длины. Мы воспользуемся состояниями, которые будут определяться перечислением.</p>
    <p>Понять перечисления крайне просто – у нас есть фрукты.</p>
    <pre><code class="code"><hr>enum Фрукты = {Яблоко, Груша, Банан, …}<hr></code></pre>
    <p>Когда нам потребуется груша, мы скажем что нам нужна «Фрукты.Груша».</p>
    <pre><code class="code"><hr>var нужный_фрукт = Фрукты.Груша<hr></code></pre>
    <p>То есть перечисление в данном случае – Фрукты. А Груша – это один из элементов перечисления.</p>
    <p>Точно так же перед функциями создадим перечисления операций, которые желаем произвести в будущем, и будем при необходимости к ним обращаться, указывая какая операция в данный момент необходима:</p>
    <pre><code class="code"><hr>enum states {Default, Plus, Minus, Division, Multiply} # определили «фрукты»
var state = states.Default # в качестве переменной указали на необходимый фрукт<hr></code></pre>
    <p>Теперь необходимо описать операции, которые будут работать по кнопкам. Для них так же будет задана одна функция, которая будет производить действия в зависимости от состояния:</p>
    <pre><code class="code"><hr># Функция производящая необходимый расчёт в зависимости от состояния 
func _calc():
    if state == states.Default:
        res = numb
        numb = 0
    else:
        if state == states.Division:
            if numb != 0:
                res /= numb
            else:
                label.text = "ERROR"
        elif state == states.Multiply:
            res *= numb
        elif state == states.Plus:
            res += numb
        elif state == states.Minus:
            res -= numb
        numb = 0<hr></code></pre>
    <p>Разберите данную функцию. Обратите внимание что производятся те или иные действия в зависимости от выбранного нами элемента перечисления – состояния. Нам остаётся лишь вызывать данную функцию при нажатии какой-либо из кнопок операторов, и сменять состояние при необходимости. Например, таким образом:</p>
    <pre><code class="code"><hr># Действия кнопок математических операторов
# вызов функции расчёта calc() и изменение состояния
func _on_mul_pressed():
    _calc()
    state = states.Multiply

func _on_div_pressed():
    _calc()
    state = states.Division

func _on_sum_pressed():
    _calc()
    state = states.Plus

func _on_sub_pressed():
    _calc()
    state = states.Minus

# Кнопка равенства
func _on_eq_pressed():
    _calc()
    state = states.Default
    if label.text != "ERROR":
        label.text = str(res)<hr></code></pre>
    <p>Таким образом мы создали калькулятор, который работает привычным для нас образом. </p>
    <p><b>Теперь самостоятельно доведите дело до конца:</b>
        <i><ul>
            <li>Реализуйте работу кнопки смены знака текущего числа (смена текущего числа с положительного на отрицательное и обратно, с обновлением табло)</li>
            <li>Реализуйте кнопку очистки данных (обнуление текущего числа, результата, сброс состояния на Default, очистка табло).</li>
        </ul></i>
    </p>
    <a href="projects/01 Calc.zip" class="project_button">
        <button class="project_button">
            <img src="../../imgs/download.png" style="max-height: 100%">
            Демонстрационный проект
        </button>
    </a>
</div>
<script src="../../scripts/codehighlighter.js"></script>